<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="google-site-verification" content="GOOGLEWEBMASTER">
	<link href="http://your.site.comatom.xml" rel="alternate" title="Hammer | ruby component based state-full web framework" type="application/atom+xml">
	<link rel="stylesheet" media="all" href="/css/master.css">
	<link rel="stylesheet" media="all" href="/css/mediaqueries.css">
	<script src="/js/modernizr.js"></script>
	
		<title>HammerBuilder Introduction | Hammer | ruby component based state-full web framework</title>
		<meta name="description" content="HammerBuilder is a xhtml5 builder written in Ruby. It does not introduce anything special, you just use Ruby to get your xhtml. HammerBuilder has been...">
	
  <link rel="shortcut icon" href="/img/hammer.png">
</head>

<body class="post">
	<div id="page">
				<header id="head">
		<div class="head_inner">
			<ul>
				<li class="logo"><a href="/">Hammer</a></li>
				<li class="tagline">ruby component based state-full web framework</li>
			</ul>
		</div>
		</header><!-- id="head" -->

		<div id="main" role="main">
			<div class="main_inner">
				<header class="hd_article">
					<h1>HammerBuilder Introduction</h1>
						<div class="meta">
							<date title="2011-05-10T00:00:00+02:00">
								<span class="published">Published: </span>
								<span class="day">10</span>
								<span class="month"><abbr>May</abbr></span>
								<span class="year">2011</span>
							</date>
						</div>
				</header>
				<article class="the_article">
				<div class="article_inner">
					<div class="content">
            <p><code>HammerBuilder</code> is a xhtml5 builder written in Ruby. It does not introduce anything special, you just use Ruby to get your xhtml. <code>HammerBuilder</code> has been written with two main objectives:</p>

<ul>
<li>Speed</li>

<li>Rich API</li>

<li>Extensibility</li>
</ul>

<h2 id='my_motivation'>My motivation</h2>

<p>I needed a fast Ruby html/xhtml builder for my jet experimental framework <code>Hammer</code>.</p>

<ul>
<li><code>Markaby</code> is slow</li>

<li><code>Tagz</code> is really slow</li>

<li><code>Wee::Brush</code> is built-in <code>Wee</code>. I did not want to dig it out and as far as i know it creates instances for each tag. That would be slow - lots of garbage.</li>

<li>Erector was the fastest but it has <code>Widgets</code> which I did not need and they were complicating things not making easier. Also there is no way of extending easily particular tags with a method.</li>
</ul>

<p>I decided to create my own builder.</p>

<h2 id='usage'>Usage</h2>

<p>There are two builders: <code>HammerBuilder::Standard</code>, <code>HammerBuilder::Formated</code>. First one builds xhtml on one line unindented. Second one formats the output.</p>

<blockquote>
<p>Originally I did two builders because I thought formated one would be slower, but it is not. Anyway, I left there both - could be useful.</p>
</blockquote>

<p>Personally I thing commented examples are the best, so here you are.</p>

<h3 id='getting_builders'>Getting builders</h3>

<p>Creating new builder is expensive. There is a pool of builders implemented.</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Formated</span><span class='o'>.</span><span class='n'>new</span> <span class='c1'># =&gt; new builder</span>
<span class='n'>b</span> <span class='o'>=</span> <span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Formated</span><span class='o'>.</span><span class='n'>get</span> <span class='c1'># =&gt; new builder from pool if there is one, or a new one</span>

<span class='c1'>#  when builder is not needed any more</span>
<span class='k'>if</span> <span class='n'>am_i_smart?</span>
  <span class='n'>b</span><span class='o'>.</span><span class='n'>release!</span><span class='p'>;</span> <span class='n'>b</span> <span class='o'>=</span> <span class='kp'>nil</span> <span class='c1'># resets builder and returns it to the pool </span>
<span class='k'>else</span>
  <span class='n'>b</span> <span class='o'>=</span> <span class='kp'>nil</span> <span class='c1'># or the reference can be lost and it gets garbage-collected</span>
<span class='k'>end</span>
</code></pre>
</div>
<blockquote>
<p><strong>Don&#8217;t</strong> forget to lose the reference in the first case. It&#8217;s yours responsibility not to use builder after you have released it.</p>
</blockquote>

<h3 id='building_xhtml'>Building xhtml</h3>

<p>Basic syntax is similar to other html/xhtml builders you may know. I borrowed from <a href='http://markaby.rubyforge.org/'>Markaby</a>, <a href='http://erector.rubyforge.org/'>Erector</a> and from not well known framework <a href='http://www.ntecs.de/projects/wee/doc/rdoc/'>Wee</a> and its <code>Wee::Brush</code>es.</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Formated</span><span class='o'>.</span><span class='n'>get</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='n'>xhtml5!</span>
  <span class='n'>html</span> <span class='k'>do</span>
    <span class='n'>head</span> <span class='p'>{</span> <span class='n'>title</span> <span class='s1'>&#39;my_page&#39;</span> <span class='p'>}</span>
    <span class='n'>body</span> <span class='k'>do</span>
      <span class='n'>div</span> <span class='ss'>:id</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;content&#39;</span> <span class='k'>do</span>
        <span class='nb'>p</span> <span class='s2'>&quot;my page&#39;s content&quot;</span><span class='p'>,</span> <span class='ss'>:class</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;centered&#39;</span>
      <span class='k'>end</span>
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml!</span> <span class='c1'># =&gt;</span>
</code></pre>
</div><div class='highlight'><pre><code class='html'><span class='cp'>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE html&gt;</span>
<span class='nt'>&lt;html</span> <span class='na'>xmlns=</span><span class='s'>&quot;http://www.w3.org/1999/xhtml&quot;</span><span class='nt'>&gt;</span>
  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>my_page<span class='nt'>&lt;/title&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
  <span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;content&quot;</span><span class='nt'>&gt;</span>
      <span class='nt'>&lt;p</span> <span class='na'>class=</span><span class='s'>&quot;centered&quot;</span><span class='nt'>&gt;</span>my page&#39;s content<span class='nt'>&lt;/p&gt;</span>
    <span class='nt'>&lt;/div&gt;</span>
  <span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre>
</div>
<p>But builder has internal class representation of each tag same as <code>Wee::Brush</code>. When <code>#div</code> is called its instance is returned, following calls are possible.</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>div</span><span class='o'>.</span><span class='n'>rclass</span> <span class='c1'># HammerBuilder::Formated::Div</span>
<span class='c1'># rclass is original ruby method #class </span>

<span class='n'>div</span><span class='o'>.</span><span class='n'>id</span> <span class='ss'>:id</span> <span class='c1'># &lt;div id=&quot;id&quot;&gt;&lt;/div&gt;</span>
<span class='n'>div</span><span class='o'>.</span><span class='n'>class</span> <span class='o'>[</span><span class='s1'>&#39;left&#39;</span><span class='p'>,</span> <span class='s1'>&#39;border&#39;</span><span class='o'>]</span> <span class='c1'># &lt;div class=&quot;left border&quot;&gt;&lt;/div&gt;</span>
<span class='n'>meta</span><span class='o'>.</span><span class='n'>http_equiv</span> <span class='s2'>&quot;content-type&quot;</span> <span class='c1'># &lt;meta http-equiv=&quot;content-type&quot; /&gt;</span>
<span class='n'>a</span><span class='o'>.</span><span class='n'>onclick</span> <span class='s1'>&#39;js&#39;</span> <span class='c1'># &lt;a onclick=&quot;js&quot;&gt;&lt;/a&gt;</span>
</code></pre>
</div>
<h3 id='tags_content'>Tag&#8217;s content</h3>

<p>How to get content into double tag:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>div</span> <span class='s1'>&#39;content&#39;</span> <span class='c1'># &lt;div&gt;content&lt;/div&gt;</span>
<span class='n'>div</span><span class='o'>.</span><span class='n'>content</span> <span class='s1'>&#39;content&#39;</span> <span class='c1'># &lt;div&gt;content&lt;/div&gt;</span>
<span class='n'>div</span> <span class='ss'>:content</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;content&#39;</span> <span class='c1'># &lt;div&gt;content&lt;/div&gt;</span>
<span class='n'>div</span> <span class='p'>{</span> <span class='n'>text</span> <span class='s1'>&#39;content&#39;</span> <span class='p'>}</span> <span class='c1'># &lt;div&gt;content&lt;/div&gt;</span>
<span class='n'>div</span><span class='o'>.</span><span class='n'>with</span> <span class='p'>{</span> <span class='n'>text</span> <span class='s1'>&#39;content&#39;</span> <span class='p'>}</span> <span class='c1'># &lt;div&gt;content&lt;/div&gt;</span>
<span class='n'>div</span><span class='p'>(</span><span class='ss'>:id</span> <span class='o'>=&gt;</span> <span class='ss'>:id</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>text</span> <span class='s1'>&#39;content&#39;</span> <span class='p'>}</span> <span class='c1'># &lt;div id=&quot;id&quot;&gt;content&lt;/div&gt;</span>
<span class='n'>div</span><span class='o'>.</span><span class='n'>id</span> <span class='ss'>:id</span> <span class='k'>do</span> 
  <span class='n'>text</span> <span class='s1'>&#39;content&#39;</span>
<span class='k'>end</span> <span class='c1'># &lt;div id=&quot;id&quot;&gt;content&lt;/div&gt;</span>
</code></pre>
</div>
<h3 id='classes'>Classes</h3>

<p>Any attribute method you call is immediately appended to output with exception of classes.</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>div</span><span class='p'>(</span><span class='ss'>:class</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;left&#39;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>class</span><span class='p'>(</span><span class='s1'>&#39;center&#39;</span><span class='p'>)</span> <span class='c1'># &lt;div class=&#39;left center&#39;&gt;&lt;/div&gt;</span>
<span class='n'>div</span><span class='p'>(</span><span class='ss'>:id</span> <span class='o'>=&lt;</span> <span class='mi'>1</span><span class='p'>)</span><span class='o'>.</span><span class='n'>id</span><span class='p'>(</span><span class='mi'>2</span><span class='p'>)</span> <span class='c1'># &lt;div id=&quot;1&quot; id=&quot;2&quot;&gt;&lt;/div&gt;</span>
</code></pre>
</div>
<h2 id='things_you_should_know_about_hammerbuilder'>Things you should know about HammerBuilder</h2>

<p><code>HammerBuilder</code> is implemented as streaming library. Anything what can be flushed to output is flushed. There are no multiple instances for each tag. Every tag of the same type share a same instance (unique within the instance of a builder).</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>puts</span><span class='p'>(</span><span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Standard</span><span class='o'>.</span><span class='n'>get</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='nb'>puts</span> <span class='n'>div</span><span class='o'>.</span><span class='n'>object_id</span>
  <span class='nb'>puts</span> <span class='n'>div</span><span class='o'>.</span><span class='n'>object_id</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml!</span><span class='p'>)</span>
<span class='c1'># output:</span>
<span class='c1'># 10069200</span>
<span class='c1'># 10069200</span>
<span class='c1'># &lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;</span>
</code></pre>
</div>
<p>Something like this cannot be constructed.</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>puts</span><span class='p'>(</span><span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Standard</span><span class='o'>.</span><span class='n'>get</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='n'>a</span> <span class='o'>=</span> <span class='n'>div</span> <span class='s1'>&#39;a&#39;</span>
  <span class='n'>div</span> <span class='s1'>&#39;b&#39;</span>
  <span class='n'>a</span><span class='o'>.</span><span class='n'>class</span> <span class='s1'>&#39;class&#39;</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml!</span><span class='p'>)</span>
</code></pre>
</div>
<p>Respectively can be, but output will be <code>&lt;div&gt;a&lt;/div&gt;&lt;div class=&quot;class&quot;&gt;b&lt;/div&gt;</code>, because when <code>#class</code> is called the second div is being builded.</p>

<h2 id='helpers'>Helpers</h2>

<p>If they are needed they can be mixed directly into Builder&#8217;s instance</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>Hammer</span><span class='o'>::</span><span class='no'>FormatedBuilder</span><span class='o'>.</span><span class='n'>new</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='kp'>extend</span> <span class='no'>ActionView</span><span class='o'>::</span><span class='no'>Helpers</span><span class='o'>::</span><span class='no'>NumberHelper</span>
  <span class='n'>div</span> <span class='n'>number_with_precision</span><span class='p'>(</span><span class='no'>Math</span><span class='o'>::</span><span class='no'>PI</span><span class='p'>,</span> <span class='ss'>:precision</span> <span class='o'>=&gt;</span> <span class='mi'>4</span><span class='p'>)</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml</span> <span class='c1'># =&gt; &lt;div&gt;3.1416&lt;/div&gt;</span>
</code></pre>
</div>
<blockquote>
<p>Be careful when you are using this with <code>Pool</code>. Some instances may have helpers and some don&#8217;t.</p>
</blockquote>

<p>or new builder descendant can be made.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>MyBuilder</span> <span class='o'>&lt;</span> <span class='no'>Hammer</span><span class='o'>::</span><span class='no'>FormatedBuilder</span>
  <span class='kp'>include</span> <span class='no'>ActionView</span><span class='o'>::</span><span class='no'>Helpers</span><span class='o'>::</span><span class='no'>NumberHelper</span>
<span class='k'>end</span>

<span class='no'>MyBuilder</span><span class='o'>.</span><span class='n'>new</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='n'>div</span> <span class='n'>number_with_precision</span><span class='p'>(</span><span class='no'>Math</span><span class='o'>::</span><span class='no'>PI</span><span class='p'>,</span> <span class='ss'>:precision</span> <span class='o'>=&gt;</span> <span class='mi'>4</span><span class='p'>)</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml</span> <span class='c1'># =&gt; &lt;div&gt;3.1416&lt;/div&gt;</span>
</code></pre>
</div>
<h2 id='extensibility'>Extensibility</h2>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>MyBuilder</span> <span class='o'>&lt;</span> <span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Formated</span>

  <span class='c1'># define new method to all tags</span>
  <span class='n'>extend_class</span> <span class='ss'>:AbstractTag</span> <span class='k'>do</span>
    <span class='k'>def</span> <span class='nf'>hide!</span>
      <span class='nb'>self</span><span class='o'>.</span><span class='n'>class</span> <span class='s1'>&#39;hidden&#39;</span>
    <span class='k'>end</span>
  <span class='k'>end</span>

  <span class='c1'># add pseudo tag</span>
  <span class='n'>define_class</span> <span class='ss'>:Component</span><span class='p'>,</span> <span class='ss'>:Div</span> <span class='k'>do</span>
    <span class='nb'>class_eval</span> <span class='o'>&lt;&lt;-</span><span class='no'>RUBYCODE</span><span class='p'>,</span> <span class='bp'>__FILE__</span><span class='p'>,</span> <span class='bp'>__LINE__</span>
<span class='sh'>      def open(id, attributes = nil, &amp;block)</span>
<span class='sh'>        super(attributes, &amp;nil).id(id).class(&#39;component&#39;)</span>
<span class='sh'>        block ? with(&amp;block) : self</span>
<span class='sh'>      end</span>
<span class='no'>    RUBYCODE</span>
  <span class='k'>end</span>
  <span class='n'>define_tag</span> <span class='ss'>:component</span>

  <span class='c1'># if the class is not needed same can be done this way</span>
  <span class='k'>def</span> <span class='nf'>simple_component</span><span class='p'>(</span><span class='nb'>id</span><span class='p'>,</span> <span class='n'>attributes</span> <span class='o'>=</span> <span class='kp'>nil</span><span class='p'>,</span> <span class='o'>&amp;</span><span class='n'>block</span><span class='p'>)</span>
    <span class='n'>div</span><span class='o'>[</span><span class='nb'>id</span><span class='o'>].</span><span class='n'>attributes</span> <span class='n'>attributes</span><span class='p'>,</span> <span class='o'>&amp;</span><span class='n'>block</span>
  <span class='k'>end</span>
<span class='k'>end</span>

<span class='no'>MyBuilder</span><span class='o'>.</span><span class='n'>get</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='n'>div</span><span class='o'>[</span><span class='ss'>:content</span><span class='o'>].</span><span class='n'>with</span> <span class='k'>do</span>
    <span class='n'>span</span><span class='o'>[</span><span class='ss'>:secret</span><span class='o'>].</span><span class='n'>class</span><span class='p'>(</span><span class='s1'>&#39;left&#39;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>hide!</span>
    <span class='n'>component</span><span class='p'>(</span><span class='s1'>&#39;component-1&#39;</span><span class='p'>)</span> <span class='k'>do</span>
      <span class='n'>strong</span> <span class='s1'>&#39;something&#39;</span>
    <span class='k'>end</span>
    <span class='n'>simple_component</span> <span class='s1'>&#39;component-1&#39;</span>
  <span class='k'>end</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml!</span>
</code></pre>
</div>
<p>result is</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;content&quot;</span><span class='nt'>&gt;</span>
  <span class='nt'>&lt;span</span> <span class='na'>id=</span><span class='s'>&quot;secret&quot;</span> <span class='na'>class=</span><span class='s'>&quot;left hidden&quot;</span><span class='nt'>&gt;&lt;/span&gt;</span>
  <span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;component-1&quot;</span> <span class='na'>class=</span><span class='s'>&quot;component&quot;</span><span class='nt'>&gt;</span>
    <span class='nt'>&lt;strong&gt;</span>something<span class='nt'>&lt;/strong&gt;</span>
  <span class='nt'>&lt;/div&gt;</span>
  <span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;component-1&quot;</span><span class='nt'>&gt;&lt;/div&gt;</span>
<span class='nt'>&lt;/div&gt;</span>
</code></pre>
</div>
<h2 id='how_to_use_hammerbuilder'>How to use HammerBuilder</h2>

<p>The idea is that any object intended to rendering will have methods which renders the object into builder. There is a <code>HammerBuilder::Helper</code> for that purpose.</p>

<p>Supose we have some <code>User</code> class with some builder methods <code>#detail</code> and <code>#attribute</code> defined,</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span> <span class='o'>&lt;</span> <span class='no'>Struct</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='ss'>:name</span><span class='p'>,</span> <span class='ss'>:login</span><span class='p'>,</span> <span class='ss'>:email</span><span class='p'>)</span>
  <span class='kp'>include</span> <span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Helper</span>

  <span class='n'>builder</span> <span class='ss'>:detail</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>user</span><span class='o'>|</span>
    <span class='n'>ul</span> <span class='k'>do</span>
      <span class='n'>user</span><span class='o'>.</span><span class='n'>attribute</span> <span class='nb'>self</span><span class='p'>,</span> <span class='ss'>:name</span>
      <span class='n'>user</span><span class='o'>.</span><span class='n'>attribute</span> <span class='nb'>self</span><span class='p'>,</span> <span class='ss'>:login</span>
      <span class='n'>user</span><span class='o'>.</span><span class='n'>attribute</span> <span class='nb'>self</span><span class='p'>,</span> <span class='ss'>:email</span>
    <span class='k'>end</span>
  <span class='k'>end</span>

  <span class='n'>builder</span> <span class='ss'>:attribute</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>user</span><span class='p'>,</span> <span class='n'>attribute</span><span class='o'>|</span>
    <span class='n'>li</span> <span class='k'>do</span>
      <span class='n'>strong</span> <span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>attribute</span><span class='si'>}</span><span class='s2'>: &quot;</span>
      <span class='n'>text</span> <span class='n'>user</span><span class='o'>.</span><span class='n'>send</span><span class='p'>(</span><span class='n'>attribute</span><span class='p'>)</span>
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span>

<span class='nb'>puts</span><span class='p'>(</span><span class='no'>HammerBuilder</span><span class='o'>::</span><span class='no'>Formated</span><span class='o'>.</span><span class='n'>get</span><span class='o'>.</span><span class='n'>go_in</span> <span class='k'>do</span>
  <span class='no'>User</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='s2'>&quot;Peter&quot;</span><span class='p'>,</span> <span class='s2'>&quot;peter&quot;</span><span class='p'>,</span> <span class='s2'>&quot;peter@example.com&quot;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>detail</span> <span class='nb'>self</span>
  <span class='nb'>p</span> <span class='s2'>&quot;builder methods are: </span><span class='si'>#{</span><span class='no'>User</span><span class='o'>.</span><span class='n'>builder_methods</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='s1'>&#39;,&#39;</span><span class='p'>)</span><span class='si'>}</span><span class='s2'>&quot;</span>
<span class='k'>end</span><span class='o'>.</span><span class='n'>to_xhtml!</span><span class='p'>)</span>
</code></pre>
</div>
<p>then we get:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;ul&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    <span class='nt'>&lt;strong&gt;</span>name: <span class='nt'>&lt;/strong&gt;</span>Peter
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    <span class='nt'>&lt;strong&gt;</span>login: <span class='nt'>&lt;/strong&gt;</span>peter
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    <span class='nt'>&lt;strong&gt;</span>email: <span class='nt'>&lt;/strong&gt;</span>peter@example.com
  <span class='nt'>&lt;/li&gt;</span>
<span class='nt'>&lt;/ul&gt;</span>
<span class='nt'>&lt;p&gt;</span>builder methods are: detail,attribute<span class='nt'>&lt;/p&gt;</span>
</code></pre>
</div>
<h2 id='benchmark'>Benchmark</h2>

<p><code>HammerBuilder</code> has been designed to be fast. So is it?</p>

<h3 id='synthetic'>Synthetic</h3>
<div class='highlight'><pre><code class='text'>                              user     system      total        real
render                    4.380000   0.000000   4.380000 (  4.394127)
render3                   4.990000   0.000000   4.990000 (  5.017267)
HammerBuilder::Standard   5.590000   0.000000   5.590000 (  5.929775)
HammerBuilder::Formated   5.520000   0.000000   5.520000 (  5.511297)
erubis                    7.340000   0.000000   7.340000 (  7.345410)
erubis-reuse              4.670000   0.000000   4.670000 (  4.666334)
fasterubis                7.700000   0.000000   7.700000 (  7.689792)
fasterubis-reuse          4.650000   0.000000   4.650000 (  4.648017)
tenjin                   11.810000   0.280000  12.090000 ( 12.084124)
tenjin-reuse              3.170000   0.010000   3.180000 (  3.183110)
erector                  12.100000   0.000000  12.100000 ( 12.103520)
markaby                  20.750000   0.030000  20.780000 ( 21.371292)
tagz                     73.200000   0.140000  73.340000 ( 73.306450)
</code></pre>
</div>
<h3 id='in_rails_3'>In Rails 3</h3>
<div class='highlight'><pre><code class='text'>BenchTest#test_erubis_partials (3.34 sec warmup)
           wall_time: 3.56 sec
              memory: 0.00 KB
             objects: 0
             gc_runs: 15
             gc_time: 0.53 ms
BenchTest#test_erubis_single (552 ms warmup)
           wall_time: 544 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 4
             gc_time: 0.12 ms
BenchTest#test_hammer_builder (2.33 sec warmup)
           wall_time: 847 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 5
             gc_time: 0.17 ms
BenchTest#test_tenjin_partial (942 ms warmup)
           wall_time: 1.21 sec
              memory: 0.00 KB
             objects: 0
             gc_runs: 7
             gc_time: 0.25 ms
BenchTest#test_tenjin_single (531 ms warmup)
           wall_time: 532 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 6
             gc_time: 0.20 ms
</code></pre>
</div>
<h3 id='conclusion'>Conclusion</h3>

<p>Template engines are slightly faster than <code>HammerBuilder</code> when template does not content a lot of inserting or partials. On the other hand when partials are used, <code>HammerBuilder</code> beats template engines. There is no overhead for partials in <code>HammerBuilder</code> compared to using partials in template engine. The difference is significant for <code>Erubis</code>, <code>Tenjin</code> is not so bad i did not find any easy way to use <code>Tenjin</code> in Rails 3 (I did some hacking).</p>

<p>So which one is better? It dependent on how much your rendering is fragmented or dynamic.</p>

<blockquote>
<p>But I thing It is save to say, <code>HammerBuilder</code> is comparable in speed with templates or even better. There is a rich API on top of that, I am happy with the results. <strong>What do you think?</strong></p>
</blockquote>
          </div>
          <div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'ruby-hammer'; // required: replace example with your forum shortname

  // The following are highly recommended additional parameters. Remove the slashes in front to use.
  var disqus_identifier = '';
  // var disqus_url = 'http://example.com/permalink-to-page.html';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

				</div>          
				</article>        
			</div>
		</div><!-- id="main" -->
		<nav class="pagenation">
		<ul>
		
		
		</ul>
		</nav>
		<footer id="foot">
<div class="foot_inner">
	<div class="hasGrid">
		<div class="left alpha grid-6"><h4></h4>

<p>
Powerd by <a href="https://github.com/mojombo/jekyll">jekyll</a>,
<a href="http://minimum.layouts-the.me/">_minimum</a>,
<a href="http://disqus.com">Disqus</a>

</p>
</div>
		<div class="right omega grid-6"><h4>Author</h4>
<p>about</p></div>
	</div>
</div>
</footer><!-- id="foot" -->

	</div><!-- id="page" -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
<!-- You may want to stats with your blog if not you should erase this file and remove inculude link from 
You don't need to edit this file, you can set your ID at _config.yml -->
<script>
	var _gaq = [['_setAccount', 'UA-XXXXX-X'], ['_trackPageview']];
	(function(d, t) {
		var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
		g.async = true;
		g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		s.parentNode.insertBefore(g, s);
	})(document, 'script');
</script>


</body>
</html>
